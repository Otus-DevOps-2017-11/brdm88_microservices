# brdm88_microservices
Dmitry Bredikhin microservice technology study repository


Homework-16
===========

##### Описание директорий репозитория:

 **docker-monolith** - наработки из предыдущих заданий
 **reddit-microservices** - код приложения в микросервисной архитектуре. 

В рамках данного задания созданы Dockerfile для сервисов **post**, **comment** и **ui**. 
Выполнена оптимизация Dockerfile для уменьшения размера итоговых образов, включающая в себя:

 * Объединение в цепочки shell-команд, запускаемых с помощью `RUN`, для уменьшения числа промежуточных слоев
 * Корректировка последовательности команд работы с файлами (для предотвращения cache miss)
 * Использование более компактных базовых образов
 * Удаление кэшированных данных пакетного менеджера
 
Произведена сборка образов и запуск контейнеров сервисов.

Было опробовано указание альтернативных сетевых алиасов при запуске контейнеров без пересоздания образов, ниже приведен листинг команд:

```
docker run -d --network=reddit --network-alias=alt_post_db --network-alias=alt_comment_db \
-v reddit_db:/data/db \
mongo:latest

docker run -d --network=reddit --network-alias=alt_post \
--env POST_DATABASE_HOST=alt_post_db \
brdm88/post:1.0 

docker run -d --network=reddit --network-alias=alt_comment \
--env COMMENT_DATABASE_HOST=alt_comment_db \
brdm88/comment:1.0

docker run -d --network=reddit -p 9292:9292 \
--env POST_SERVICE_HOST=alt_post --env COMMENT_SERVICE_HOST=alt_comment \
brdm88/ui:1.0
```

Файл `build-cmds.sh` содержит рабочие команды для сборки образов и запуска контейнеров.
 
Для сервисов **comment** и **ui** были собраны образы на базе **Alpine Linux** с минимальным набором пакетов, в репозитории - переработанные Dockerfile.
Размеры образов составили соответственно 146 и 206 МБ.

Для максимального уменьшения размера конечного образа целесообразно применить multi-stage builds. Данная практика максимально эффективна для 
приложений на компилируемых языках программирования. В нашем случае код приложения написан на интерпретируемых языках Python и Ruby, 
однако некоторые gem-ы (а именно, `bson_ext`) имеют код на языке C. Build-окружение для него можно оставить только в образе стадии сборки, 
а в production-образ поместить поместить уже собранные бинарные файлы. При этом придется использовать разные наборы gem-ов для разных стадий.


----
----


Homework-15
===========

##### Общие сведения.

Предварительно на рабочую машину была установлена docker-machine версии 0.14.0.
Создана конфигурация для сборки docker-образа для приложения reddit. Произведена сборка образа при помощи `docker build`, а также его загрузка 
в репозиторий на **Docker Hub**.

Скрипты создания хоста docker-machine и правила файервола для Puma находятся в директории **config-scripts**.
Dockerfile и сопутствующие файлы конфигурации для создания образа находаятся в директории **build-reddit-image**.


----
----


Homework-14
===========

##### Общие сведения.

В рамках выполнения данного задания была произведена установка Docker version 18.02.0-ce-rc2 из официального репозитория.
Проведено тестирование запуска и останова контейнеров в различных режимах (`docker run`, `docker start`, `docker attach`, `docker exec`, `docker stop`); 
создания образов из контейнеров (`docker commit`), удаления контейнеров и образов (`docker rm`, `docker rmi`) с различными условиями.

В файле **docker-1.log** приведен вывод команды `docker images` после проведения ряда тестов.

##### Дополнительное задание.

Исследовано различие вывода команды `docker inspect` для образа и для контейнера, детали описаны в файле **docker-1.log**.
